!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("ExploratoryMap",[],t):"object"==typeof exports?exports.ExploratoryMap=t():e.ExploratoryMap=t()}(window,(function(){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){n(2);class o{constructor(e={}){this.options=Object.assign({selector:".exploratory-text-block",color:"#0dae0b"},e),this.block=document.querySelector(this.options.selector),this.block||console.warn('No element matched the selector "'+this.options.selector+'"'),this.svg=d3.select(this.block).append("svg"),this.links=this.block.querySelectorAll(".exploratory-text-inner a"),this.side=this.block.querySelector(".exploratory-text-side"),this.panels=document.querySelectorAll(".exploratory-text-panel"),this.paths=[],this.init()}drawConnection(e,t,n,o){if(!t||!n||!o)return;const i=n.querySelector(".title"),s=t.querySelector(".anchor"),l=this.block.getBoundingClientRect(),c=s.getBoundingClientRect(),r=(n.getBoundingClientRect(),i.getBoundingClientRect()),a=(document.documentElement.scrollTop,r.right-l.left),d=r.y+r.height/2-l.top,u=c.left-l.left,p=c.y+c.height/2-l.top;return e.moveTo(a,d),e.lineTo(u,p),e}makeConnections(){const e=this,t=this.block.clientWidth,n=this.block.clientHeight;this.svg.attr("width",t).attr("height",n),this.links.forEach((function(t,n){let o=e.panels[n],i=e.paths[n];if(i||(i=e.svg.append("path"),i.attr("data-index",n),e.paths.push(i)),!t.querySelector(".anchor")){let e=t.innerText.split(" ");e[0]="<span class='anchor'>"+e[0]+"</span>",t.innerHTML=e.join(" ")}i.classed(t.getAttribute("class"),!0),i.attr("d",e.drawConnection(d3.path(),t,o,i))}))}selectConnection(e){let t=this.panels[e],n=this.links[e],o=this.paths[e];if(t){let e=t.querySelector("details");t.classList.toggle("selected"),e.open=!e.open}n&&n.classList.toggle("selected"),o&&o.classed("selected",!o.classed("selected")),this.makeConnections()}showConnection(e){let t=this.panels[e],n=this.links[e],o=this.paths[e];t&&t.classList.add("visible"),n&&n.classList.add("visible"),o&&o.classed("visible",!0),this.makeConnections()}hideConnection(e){let t=this.panels[e],n=this.links[e],o=this.paths[e];t&&t.classList.remove("visible"),n&&n.classList.remove("visible"),o&&o.classed("visible",!1),this.makeConnections()}positionPanels(e){const t=this.block.querySelector(".exploratory-text-side"),n=void 0!==window.pageXOffset,o="CSS1Compat"===(document.compatMode||"");n?window.pageYOffset:o?document.documentElement.scrollTop:document.body.scrollTop;this.block.getBoundingClientRect().y<=document.querySelector("nav.fixed").getBoundingClientRect().y?t.classList.add("fixed"):t.classList.remove("fixed")}init(){const e=this,t=document.querySelector(".exploratory-text-side-inner");this.panels.forEach((n,o)=>{(n=t.appendChild(n)).dataset.index=o;let i=n.querySelector("summary");i.onclick=function(t){t.preventDefault();let o=n.dataset.index;e.selectConnection(o)},i.onmouseover=function(t){let o=n.dataset.index;e.showConnection(o)},i.onmouseleave=function(t){let o=n.dataset.index;e.hideConnection(o)},n.classList.remove("hidden")}),this.links.forEach((function(t,n){const o=t.getAttribute("class"),i=e.panels[n];i&&i.classList.add(o),t.dataset.index=n,t.onclick=function(n){n.preventDefault();let o=t.dataset.index;e.selectConnection(o)},t.onmouseover=function(n){let o=t.dataset.index;e.showConnection(o)},t.onmouseleave=function(n){let o=t.dataset.index;e.hideConnection(o)}})),this.side.onscroll=function(t){e.makeConnections()},window.onscroll=function(t){e.makeConnections(),e.positionPanels()},window.onresize=function(t){e.makeConnections(),e.positionPanels()},this.makeConnections(),this.positionPanels()}}window.onload=function(){new o}},function(e,t,n){}])}));
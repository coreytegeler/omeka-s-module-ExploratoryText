!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("ExploratoryMap",[],e):"object"==typeof exports?exports.ExploratoryMap=e():t.ExploratoryMap=e()}(window,(function(){return function(t){var e={};function n(o){if(e[o])return e[o].exports;var i=e[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(o,i,function(e){return t[e]}.bind(null,i));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){t.exports=n(1)},function(t,e,n){n(2);class o{constructor(t={}){this.options=Object.assign({selector:".exploratory-text-block",color:"#0dae0b"},t),this.block=document.querySelector(this.options.selector),this.block||console.warn('No element matched the selector "'+this.options.selector+'"'),this.svg=d3.select(this.block).append("svg"),this.side=this.block.querySelector(".et-side"),this.sideInner=this.side.querySelector(".et-side-inner"),this.nav=document.querySelector("nav.fixed"),this.highlights=[null],this.annots=[null],this.paths=[null],this.init()}getAnnot(t){return this.block.querySelector(".et-annot[data-index='"+t+"']")}getHighlight(t){return this.block.querySelectorAll(".et-highlight[data-index='"+t+"']")}drawConnection(t,e,n,o){if(!e||!n||!o)return;const i=e.querySelector(".et-first"),s=this.block.getBoundingClientRect(),l=i.getBoundingClientRect(),r=n.getBoundingClientRect(),c=(document.documentElement.scrollTop,r.right-s.left),a=r.y+r.height/2-s.top,d=l.left-s.left,h=l.y+l.height/2-s.top;return t.moveTo(c,a),t.lineTo(d,h),t}showConnection(t){let e=this.getAnnot(t),n=this.getHighlight(t);this.paths[t];e&&e.classList.add("et-focus"),n.forEach(t=>t.classList.add("et-focus"))}hideConnection(t){let e=this.getAnnot(t),n=this.getHighlight(t);this.paths[t];e&&e.classList.remove("et-focus"),n.forEach(t=>t.classList.remove("et-focus"))}scrollTo(t){const e=this.getAnnot(t),n=document.querySelector("nav.fixed"),o=this.block.querySelector(".et-side-inner");if(!e)return;const i=e.getBoundingClientRect(),s=o.getBoundingClientRect();n.getBoundingClientRect();o.scrollBy({top:i.top-s.top,behavior:"smooth"})}openAnnotation(t){const e=this.getAnnot(t),n=this.getHighlight(t);this.paths[t];e&&e.classList.add("et-open"),n.forEach(t=>t.classList.add("et-open")),this.scrollTo(t),this.side.classList.remove("et-side-empty"),this.showConnection(t)}closeAnnotation(t){const e=this.getAnnot(t),n=this.getHighlight(t);this.paths[t];e&&e.classList.remove("et-open"),n.forEach(t=>t.classList.remove("et-open")),this.side.querySelectorAll(".et-open").length||this.side.classList.add("et-side-empty"),this.hideConnection(t)}positionAnnotations(t){const e=this.block.getBoundingClientRect(),n=this.nav.getBoundingClientRect(),o=this.side.getBoundingClientRect();this.sideInner.getBoundingClientRect();if(this.sideInner.style.width=o.width+"px",this.side.style.height=this.sideInner.scrollHeight+o.top+"px",e.y<=n.height){const t=this.block.querySelector(".et-body").getBoundingClientRect();let e;e=t.bottom<window.innerHeight?window.innerHeight-(window.innerHeight-t.bottom)-n.height:window.innerHeight-n.height,this.sideInner.style.height=e+"px",this.sideInner.style.position="fixed",this.sideInner.style.left=o.x+"px",this.sideInner.style.top=n.height+"px"}else this.sideInner.style.position="absolute",this.sideInner.style.left="",this.sideInner.style.top=""}resizeAnnotation(t){t.classList.toggle("et-less")}init(){const t=this,e=document.querySelector(".et-side-inner"),n=this.block.querySelectorAll(".et-body a"),o=document.querySelectorAll(".et-annot");let i=1;o.forEach((o,s)=>{o.querySelector(".et-annot-body");const l=o.querySelector(".et-annot-index"),r=o.querySelector(".et-annot-toggle"),c=o.querySelector(".et-annot-close"),a=(o=e.appendChild(o)).dataset.highlight;n.forEach((function(e,n){if(a===e.innerText){const n=o.dataset.type;e.classList.add("et-highlight"),e.dataset.type=n,e.dataset.index=i,o.dataset.index=i,l.innerText=i,t.annots[i]=o,t.highlights[i]=e}})),o.onmouseover=function(e){const n=o.dataset.index;t.showConnection(n)},o.onmouseleave=function(e){const n=o.dataset.index;t.hideConnection(n)},r.onclick=function(e){t.resizeAnnotation(o)},c.onclick=function(e){const n=o.dataset.index;t.closeAnnotation(n)},o.classList.remove("hidden"),i++}),n.forEach((function(e,n){const o=e.dataset.type,i=e.dataset.index,s=t.getAnnot(i);s&&s.classList.add(o);let l=e.innerText,r=parseInt(e.dataset.index),c=l.split(" "),a=c.length;isNaN(r)?e.setAttribute("class","inactive"):(c.length>1?(c[0]="<span class='et-first'>"+c[0]+"</span>",c[a-1]="<span class='et-last' data-index-label='"+r+"'>"+c[a-1]+"</span>"):c[0]="<span class='et-first et-last' data-index-label='"+r+"'>"+c[0]+"</span>",e.innerHTML=c.join(" ")),e.onclick=function(n){n.preventDefault();let o=e.dataset.index;t.openAnnotation(o)},e.onmouseover=function(n){let o=e.dataset.index;t.showConnection(o)},e.onmouseleave=function(n){let o=e.dataset.index;t.hideConnection(o)}})),this.side.onscroll=function(t){},window.onscroll=function(e){t.positionAnnotations()},window.onresize=function(e){t.positionAnnotations()},this.positionAnnotations()}}window.onload=function(){new o}},function(t,e,n){}])}));